# topology documentation: http://containerlab.srlinux.dev/lab-examples/srl-ceos/
name: firewallLab
# tcpdump permet de voir le traffic qui passe sur une interface !
topology:
  nodes:
    client1:
      kind: linux
      image: riushda/master_thesis_firewall:mqtt_pre-installed
      exec :
        - ip addr add 10.10.2.2/24 dev eth1
        - ip route add 10.10.4.0/24 via 10.10.2.1
        - ip route add 10.10.5.0/24 via 10.10.2.1
      mgmt_ipv4: 172.20.20.2
    firewall:
      kind: linux
      image: riushda/master_thesis_firewall:firewall_pre-installed
      exec : 
        - ip addr add 10.10.2.1/24 dev eth1
        - ip addr add 10.10.4.1/24 dev eth3
        - ip addr add 10.10.5.1/24 dev eth2
      mgmt_ipv4: 172.20.20.3
    broker:
      kind: linux
      image: riushda/master_thesis_firewall:mqtt_pre-installed
      exec :
        - ip addr add 10.10.4.2/24 dev eth1
        - ip route add 10.10.5.0/24 via 10.10.4.1
        - ip route add 10.10.2.0/24 via 10.10.4.1
      mgmt_ipv4: 172.20.20.4
    client2:
      kind: linux
      image: riushda/master_thesis_firewall:mqtt_pre-installed
      exec :
        - ip addr add 10.10.5.2/24 dev eth1
        - ip route add 10.10.2.0/24 via 10.10.5.1
        - ip route add 10.10.4.0/24 via 10.10.5.1
      mgmt_ipv4: 172.20.20.5
  links:
    - endpoints: ["client1:eth1", "firewall:eth1"]
    - endpoints: ["client2:eth1", "firewall:eth2"]
    - endpoints: ["broker:eth1", "firewall:eth3"]
    
