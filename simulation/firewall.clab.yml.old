# topology documentation: http://containerlab.srlinux.dev/lab-examples/srl-ceos/
name: firstLab
# tcpdump permet de voir le traffic qui passe sur une interface !
topology:
  nodes:
    client1:
      kind: linux
      image: trafex/alpine-mosquitto
      exec :
        - sh -c 'echo -e "http://nl.alpinelinux.org/alpine/v3.11/main\nhttp://nl.alpinelinux.org/alpine/v3.11/community" > /etc/apk/repositories'
        - apk update && apk add tcptraceroute iproute2 tcpdump
        - ip addr add 10.10.2.2/24 dev eth1
        - ip route add 10.10.4.0/24 via 10.10.2.1
        - ip route add 10.10.5.0/24 via 10.10.2.1
      mgmt_ipv4: 172.20.20.2
    firewall:
      kind: linux
      image: ubuntu:20.04
      exec : 
        - apt-get update
        - apt-get install -y apt-utils iptables net-tools iputils-ping iproute2 traceroute
        - update-alternatives --set ip6tables /usr/sbin/ip6tables-nft
        - ip addr add 10.10.2.1/24 dev eth1
        - ip addr add 10.10.4.1/24 dev eth3
        - ip addr add 10.10.5.1/24 dev eth2
      mgmt_ipv4: 172.20.20.3
    broker:
      kind: linux
      image: trafex/alpine-mosquitto
      exec :
        - sh -c 'echo -e "http://nl.alpinelinux.org/alpine/v3.11/main\nhttp://nl.alpinelinux.org/alpine/v3.11/community" > /etc/apk/repositories'
        - apk update && apk add tcptraceroute iproute2 tcpdump
        - ip addr add 10.10.4.2/24 dev eth1
        - ip route add 10.10.5.0/24 via 10.10.4.1
        - ip route add 10.10.2.0/24 via 10.10.4.1
      mgmt_ipv4: 172.20.20.4
    client2:
      kind: linux
      image: trafex/alpine-mosquitto
      exec :
        - sh -c 'echo -e "http://nl.alpinelinux.org/alpine/v3.11/main\nhttp://nl.alpinelinux.org/alpine/v3.11/community" > /etc/apk/repositories'
        - apk update && apk add tcptraceroute iproute2 tcpdump
        - ip addr add 10.10.5.2/24 dev eth1
        - ip route add 10.10.2.0/24 via 10.10.5.1
        - ip route add 10.10.4.0/24 via 10.10.5.1
      mgmt_ipv4: 172.20.20.5
  links:
    - endpoints: ["client1:eth1", "firewall:eth1"]
    - endpoints: ["client2:eth1", "firewall:eth2"]
    - endpoints: ["broker:eth1", "firewall:eth3"]
    
